config:
  defaultChartId: helm-dummy
vars: {}

charts:
  helm-dummy:
    chartUrl: https://notused/dummy/
    version: 1.1.7

  helm-prometheus-k8s:
    chartUrl: https://its-software-services-devops.github.io/helm-prometheus-k8s/
    version: 1.2.1

  helm-grafana-k8s:
    chartUrl: https://its-software-services-devops.github.io/helm-grafana-k8s/
    version: 1.1.1

  cert-manager:
    chartUrl: https://charts.jetstack.io
    version: 1.3.1

  helm-cluster-certificates:
    chartUrl: https://its-software-services-devops.github.io/helm-cluster-certificates/
    version: 1.1.2

  kubernetes-external-secrets:
    chartUrl: https://external-secrets.github.io/kubernetes-external-secrets/
    version: 8.3.0

  helm-loki:
    chartUrl: https://its-software-services-devops.github.io/helm-loki/
    version: 1.1.2

  memcached:
    chartUrl: https://charts.bitnami.com/bitnami/
    version: 5.15.1

  kube-prometheus-stack:
    chartUrl: https://prometheus-community.github.io/helm-charts
    version: 17.2.1

  grafana:
    chartUrl: https://grafana.github.io/helm-charts
    version: 6.16.2

copy:
  - from: gs://yru-openedx-vault/${ENV.ENVIRONMENT}/secrets-${ENV.ENVIRONMENT}.txt
    toDir: ""

infraIasc:
  - valuesFiles: [01-setup/cert-manager/cert-manager.yaml]
    alias: rendered-cert-manager
    chartId: cert-manager
    namespace: cert-manager
    toDir: 01-setup/cert-manager

  - valuesFiles: [02-deploy/certificates/certificates.yaml]
    alias: rendered-cluster-certs
    chartId: helm-cluster-certificates
    toDir: 02-deploy/certificates
    values: []

  - valuesFiles: [02-deploy/prometheus/prometheus-alert-config.yaml]
    alias: rendered-prometheus-config
    chartId: helm-prometheus-k8s
    toDir: 02-deploy/prometheus
    values:
      - --set-string alertmanager.generic.config.alertNoti.slackUrl=${SEC.ALERT_NOTI_SLACK_URL}

  - valuesFiles: [02-deploy/prometheus/grafana-k8s.yaml]
    alias: rendered-grafana-k8s
    chartId: helm-grafana-k8s
    toDir: 02-deploy/prometheus
    namespace: monitoring
    values: []

  - valuesFiles: [02-deploy/external-secrets/external-secrets.yaml]
    alias: rendered-external-secrets
    chartId: kubernetes-external-secrets
    toDir: 02-deploy/external-secrets
    namespace: external-secrets

  - valuesFiles: [02-deploy/loki-log/loki-stack.yaml]
    alias: rendered-loki-stack
    chartId: helm-loki
    toDir: 02-deploy/loki-log
    namespace: loki-log
    template: loki-log
    values: []

  - valuesFiles: [02-deploy/memcached/memcached.yaml]
    alias: rendered-memcached
    chartId: memcached
    toDir: 02-deploy/memcached
    namespace: memcached
    values: []

  - valuesFiles: [02-deploy/platform-monitor/prometheus-stack.yaml]
    alias: rendered-prometheus-stack
    chartId: kube-prometheus-stack
    toDir: 02-deploy/platform-monitor
    namespace: platform-monitor
    values: []

  - valuesFiles: [02-deploy/platform-monitor/grafana-platform.yaml]
    alias: rendered-grafana-platform
    chartId: grafana
    toDir: 02-deploy/platform-monitor
    namespace: platform-monitor
    values: []
